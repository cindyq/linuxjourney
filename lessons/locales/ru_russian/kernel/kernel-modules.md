# Модули kernel

## Содержание урока

Допустим, у меня приятная поездка, я вкладываю в нее много времени и денег. Я добавляю спойлер, автомат, велосипедную стойку и другие случайные вещи. Эти компоненты фактически не меняют основные функции автомобиля, и я могу их легко удалить и добавить. Kernel использует ту же концепцию с модулями ядра.

Ядро само по себе является монолитной частью программного обеспечения, когда мы хотим добавить поддержку для нового типа клавиатуры, мы не записываем этот код непосредственно в код ядра. Так же, как мы не собирали велосипедную стойку в нашу машину (возможно, некоторые люди это сделают). Модули ядра представляют собой фрагменты кода, которые могут быть загружены и выгружены в ядро по требованию. Они позволяют нам расширить функциональность ядра, не добавляя в основной код ядра код. Мы также можем добавлять модули и не перезагружать систему (в большинстве случаев).

<b>Просмотр списка загруженных модулей</b>

<pre>$ lsmod</pre>

<b>Загрузка модуля</b>

<pre>$ sudo modprobe bluetooth</pre>

Modprobe загружает модуль из <b>/lib/modules/(версия ядра)/kernel/drivers</b>. Модули ядра могут также иметь зависимости, modprobe загружает наши зависимости модулей, если они еще не загружены.

<b>Удалить модуль</b>

<pre>$ sudo modprobe -r bluetooth</pre>

<b>Загрузка при запуске</b>

Вы также можете загружать модули во время загрузки системы, вместо временной загрузки их с modprobe (который будет выгружен при перезагрузке). Просто измените каталог <b>/etc/modprobe.d</b> и добавьте в него конфигурационный файл следующим образом:

<pre>pete@icebox:~$ /etc/modprobe.d/peanutbutter.conf

options peanut_butter type=almond
</pre>

Немного странный пример, но если у вас есть модуль с именем peanut_butter, и вы хотите добавить параметр ядра для type = almond, вы можете загрузить его при запуске с помощью этого файла конфигурации. Также обратите внимание, что модули ядра имеют свои собственные параметры ядра.

<b>Не загружать при запуске</b>

Вы также можете убедиться, что модуль не загружается при запуске, добавив файл конфигурации, например:

<pre>pete@icebox:~$ /etc/modprobe.d/peanutbutter.conf

blacklist peanut_butter
</pre>

## Задание

Разгрузите модуль bluetooth с помощью modprobe и посмотрите, что произойдет. Как вы это исправите?

## Вопрос

Какая команда используется для выгрузки модуля?

## Ответ

modprobe -r