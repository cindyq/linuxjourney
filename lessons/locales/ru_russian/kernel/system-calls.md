# Системные вызовы

## Содержание урока

Помните Бритни в предыдущем уроке? Скажем, мы хотим увидеть ее и вместе выпить чего-нибудь, как нам выйти из стоящих снаружи в толпе людей в ее внутренний круг? Мы будем использовать системные вызовы. Системные вызовы похожи на VIP-проходы, которые приводят вас к секретной боковой двери, ведущей непосредственно к Бритни.

Системные вызовы (syscall) предоставляют процессам пространства пользователя способ запросить ядро и сделать что-то для нас. Ядро предоставляет определенные службы через API системного вызова. Эти сервисы позволяют нам читать или записывать в файл, изменять использование памяти, изменять нашу сеть и т.д. Количество услуг фиксировано, поэтому вы не можете добавлять системные вызовы, ваша система уже имеет таблицу с системными вызовами, которые уже существуют, и каждый системный вызов имеет уникальный идентификатор.

Мы не будем подробно останавливаться на системных вызовах, поскольку для этого потребуется, чтобы вы знали немного C, но основы в том, что когда вы вызываете программу наподобие ls, код внутри этой программы содержит оболочку системных вызовов (а не фактический системный вызов). Внутри этой оболочки он вызывает системный вызов, который будет исполнять ловушку, затем эта ловушка попадает в обработчик системных вызовов, а затем ссылается на системный вызов в таблице системных вызовов. Предположим, что мы пытаемся вызвать системный вызов stat(), он идентифицируется syscall, и целью системного вызова stat() является запрос состояния файла. Теперь помните, что вы запускали программу ls в режиме без привилегий. Итак, теперь он видит, что вы пытаетесь сделать системный вызов, затем переключает вас в режим ядра, там он делает много вещей, но самое главное, он ищет ваш номер syscall, находит его в таблице, основанной на идентификаторе syscall, а затем Выполняет функцию, которую вы хотите запустить. Как только это будет сделано, он вернется в режим пользователя, и ваш процесс получит статус возврата, если он был успешным или имел ошибку. 

Фактически вы можете просматривать системные вызовы, которые процесс делает с помощью команды strace. Команда strace полезна для отладки процесса выполнения программы.

<pre>$ strace ls</pre>

## Задание

Никаких упражнений для этого урока.

## Вопрос

Что используется для переключения из режима пользователя в режим ядра?

## Ответ

system call
