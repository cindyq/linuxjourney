# Канальный уровень

## Содержание урока

В нижней части модели TCP/IP находится канальный уровень. Этот уровень является аппаратно-зависимым слоем.

В канальном слое наш пакет снова инкапсулируется во что-то, называемое фреймом. Заголовок фрейма прикрепляет MAC-адреса источника и назначения наших хостов, контрольные суммы и разделители пакетов, чтобы получатель мог определить, когда пакет заканчивается.

К счастью, мы в одной сети, поэтому нашему пакету не придется слишком далеко ехать. Во-первых, канальный уровень присоединяет мой MAC-адрес источника к заголовку кадра, но ему также нужно знать MAC-адрес Пэтти. Откуда он знает, что и как я нахожу его, поскольку он не находится в Интернете? Мы используем ARP!

<b>ARP (протокол разрешения адресов)</b>

ARP находит MAC-адрес, связанный с IP-адресом. ARP используется в той же сети. Если бы Патти не был в одной сети, мы бы использовали систему маршрутизации, чтобы определить следующий маршрутизатор, который получит этот пакет, и как только мы окажемся в одной сети, мы сможем использовать ARP.

Когда мы находимся в одной сети, системы сначала используют таблицу поиска ARP, которая хранит информацию о том, какие IP-адреса связаны с каким MAC-адресом. Если значения нет, то используется ARP. Затем система отправит широковещательное сообщение в сеть по протоколу ARP, чтобы узнать, какой хост имеет IP 10.10.1.4. Широковещательное сообщение - это специальное сообщение, которое отправляется всем узлам сети (точно названным для отправки широковещательной передачи). Любая машина с запрошенным IP-адресом ответит пакетом ARP, содержащим IP-адрес и MAC-адрес.

Теперь, когда у нас есть все необходимые данные, IP-адрес и MAC-адреса, наш канальный слой пересылает этот фрейм через нашу карту сетевого интерфейса на следующее устройство и находит сеть Пэтти. Этот шаг немного сложнее, чем то, как я только что объяснил, но мы обсудим более подробно в курсе маршрутизации.

И там это простой (или не очень простой) прогон пакетов вниз по TCP/IP слою. Имейте в виду, что пакеты не путешествуют одним способом, подобным этому. Мы еще даже не добрались до сети Пэтти! При путешествии по сетям ему требуется пройти через модель TCP/IP не менее двух раз, прежде чем любые данные будут отправлены или получены. На самом деле, вид этого пакета выглядит примерно так:

<b>Обход пакетов</b>

<ol>
<li>Пит отправляет Пэтти электронное письмо: эти данные отправляются на транспортный уровень</li>
<li>Транспортный уровень инкапсулирует данные в заголовок TCP или UDP, чтобы сформировать сегмент, сегмент присоединяет целевой и исходный TCP или UDP-порт, затем сегмент отправляется на сетевой уровень</li>
<li>Сетевой уровень инкапсулирует сегмент TCP внутри IP-пакета, он присоединяет IP-адрес источника и получателя. Затем маршрутизирует пакет к канальному уровню</li>
<li>Затем пакет достигает физического оборудования Пита и инкапсулируется в кадр. MAC-адрес источника и получателя добавляется в кадр</li>
<li>Пэтти получает этот кадр данных через свой физический уровень и проверяет каждый кадр на целостность данных, затем декапсулирует содержимое кадра и отправляет IP-пакет на сетевой уровень</li>
<li>Сетевой уровень считывает пакет, чтобы найти IP-адрес источника и назначения, который был ранее присоединен. Он проверяет, не совпадает ли его IP с IP-адресом назначения, каким он является! Он деинкапсулирует пакет и отправляет сегмент на транспортный уровень</li>
<li>Транспортный уровень де-инкапсулирует сегменты, проверяет номера портов TCP или UDP и устанавливает соединение с прикладным уровнем на основе этих номеров портов</li>
<li>Уровень приложения получает данные от транспортного уровня на указанном порту и представляет его Пэтти в виде окончательного сообщения электронной почты</li>
</ol>

## Задание

Нет задания для этого урока.

## Вопрос

Что используется для поиска MAC-адреса в той же сети?

## Ответ

ARP
