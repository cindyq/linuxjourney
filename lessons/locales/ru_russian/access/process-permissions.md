# Разрешения для процесса

## Содержание урока

Давайте немного поговорим о разрешениях для процесса, помните, как я сказал вам, что когда вы запустите команду passwd с разрешенным битом разрешения SUID, вы запустите программу как пользователь root? Это правда, однако это означает, что поскольку вы временно root, вы можете изменять пароли других пользователей? Нет, к счастью, нет!

Это из-за UID, которые реализует Linux. С каждым процессом связаны три UIDS:

Когда вы запускаете процесс, он запускается с теми же правами, что и пользователь или группа, которые его запускали, это известно как <b> эффективный идентификатор пользователя </b>. Этот UID используется для предоставления прав доступа к процессу. Естественно, если Боб запускает команду touch, процесс будет работать от Боба, и все созданные им файлы будут находиться в его собственности.

Существует еще один UID, называемый <b> реальным идентификатором пользователя </b>. Это идентификатор пользователя, запустившего процесс. Они используются для отслеживания пользователей, запустивших процесс.

Последний UID - это <b> сохраненный идентификатор пользователя </b>, он позволяет процессу переключаться между эффективным UID и реальным UID, и наоборот. Это полезно, потому что мы не хотим, чтобы наш процесс выполнялся с повышенными привилегиями все время, это просто хорошая практика использовать специальные привилегии в определенное время. 

Теперь давайте объединим все эти данные, посмотрев еще раз команду passwd. 

При запуске команды passwd ваш эффективный UID - это ваш идентификатор пользователя, скажем, его 500 на данный момент. Ой, но подождите, помните, что команда passwd имеет разрешение SUID. Поэтому, когда вы запустите его, ваш эффективный UID теперь равен 0 (0 - это UID корня). Теперь эта программа может обращаться к файлам как root.

Допустим, у вас есть небольшой вкус власти, и вы хотите изменить пароль Салли, у Салли есть UID 600. Ну, вам не повезло, к счастью, у процесса также есть ваш реальный UID в этом случае 500. Он знает, что ваш UID равен 500, поэтому вы не можете изменить пароль UID на 600. (Это, конечно, всегда обходится, если вы являетесь суперпользователем на машине и можете контролировать и изменять все).

Поскольку вы запустили passwd, он запустит процесс с использованием вашего реального UID, и он сохранит UID владельца файла (эффективный UID), чтобы вы могли переключаться между ними. Нет необходимости изменять все файлы с правами доступа root, если это не требуется. 

В большинстве случаев реальный UID и эффективный идентификатор UID одинаковы, но в таких случаях, как команда passwd, они будут меняться.

## Задание

Мы еще не обсуждали процессы, мы все же можем взглянуть на это изменение, происходящее в режиме реального времени:

<ol>
<li>Откройте одно окно терминала и выполните команду: <b>watch -n 1 "ps aux | grep passwd"</b>. Это будет следить за процессом passwd.</li>
<li>Откройте второе окно терминала и запустите: <b>passwd</b></li>
<li>Посмотрите на первое окно терминала, вы увидите, что процесс подходит для passwd. Первый столбец в таблице процессов - это эффективный идентификатор пользователя, и вот он - пользователь root!</li>
</ol>

## Вопрос

Какой UID решает, какой доступ предоставить?

## Ответ

Эффективный
