# Анализ пакетов

## Содержание урока

Тема пакетного анализа могла бы заполнить весь собственный курс, и есть много книг, написанных только при анализе пакетов. Однако сегодня мы просто изучим основы. Есть два чрезвычайно популярных анализатора пакетов, Wireshark и tcpdump. Эти инструменты сканируют сетевые интерфейсы, фиксируют активность пакетов, анализируют пакеты и выводят информацию для просмотра. Они позволяют нам вникать в мелочи сетевого анализа и попадать в вещи низкого уровня. Мы будем использовать tcpdump, поскольку он имеет более простой интерфейс, однако, если вы возьмете анализ пакетов для своего инструментального ремня, я бы рекомендовал изучить Wireshark.

<b>Установка tcpdump</b>

<pre>
$ sudo apt install tcpdump
</pre>

<b>Захват пакетных данных на интерфейсе</b>

<pre>
pete@icebox:~$ sudo tcpdump -i wlan0
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on wlan0, link-type EN10MB (Ethernet), capture size 65535 bytes
11:28:23.958840 IP icebox.lan > nuq04s29-in-f4.1e100.net: ICMP echo request, id 1901, seq 2, length 64
11:28:23.970928 IP nuq04s29-in-f4.1e100.net > icebox.lan: ICMP echo reply, id 1901, seq 2, length 64
11:28:24.960464 IP icebox.lan > nuq04s29-in-f4.1e100.net: ICMP echo request, id 1901, seq 3, length 64
11:28:24.979299 IP nuq04s29-in-f4.1e100.net > icebox.lan: ICMP echo reply, id 1901, seq 3, length 64
11:28:25.961869 IP icebox.lan > nuq04s29-in-f4.1e100.net: ICMP echo request, id 1901, seq 4, length 64
11:28:25.976176 IP nuq04s29-in-f4.1e100.net > icebox.lan: ICMP echo reply, id 1901, seq 4, length 64
11:28:26.963667 IP icebox.lan > nuq04s29-in-f4.1e100.net: ICMP echo request, id 1901, seq 5, length 64
11:28:26.976137 IP nuq04s29-in-f4.1e100.net > icebox.lan: ICMP echo reply, id 1901, seq 5, length 64
11:28:30.674953 ARP, Request who-has 172.254.1.0 tell ThePickleParty.lan, length 28
11:28:31.190665 IP ThePickleParty.lan.51056 > 192.168.86.255.rfe: UDP, length 306
</pre>

Вы заметите, что много чего происходит, когда вы запускаете захват пакетов, что вполне ожидаемо, что в фоновом режиме происходит много сетевой активности. В приведенном выше примере я взял только фрагмент моего снимка, в частности, время, когда я решил выполнить ping на www.google.com.

<b>Понимание выходных данных</b>

<pre>
11:28:23.958840 IP icebox.lan > nuq04s29-in-f4.1e100.net: ICMP echo request, id 1901, seq 2, length 64
11:28:23.970928 IP nuq04s29-in-f4.1e100.net > icebox.lan: ICMP echo reply, id 1901, seq 2, length 64
</pre>

<ul>
<li>Первое поле представляет собой временную метку сетевой активности</li>
<li>IP, это содержит информацию протокола</li>
<li>Затем вы увидите адрес источника и получателя: icebox.lan > nuq04s29-in-f4.1e100.net</li>
<li>seq, это начало и конец порядкового номера TCP-пакетов</li>
<li>длина, длина в байтах</li>
</ul>

Как вы можете видеть из нашего вывода tcpdump, мы отправляем пакет ICMP echo запрос на www.google.com и получаем ответный echo-пакет ICMP в ответ! Также обратите внимание, что различные пакеты будут выводить различную информацию, обратитесь к странице руководства, чтобы узнать, что это такое.

<b>Запись вывода tcpdump в файл</b>

<pre>
$ sudo tcpdump -w /some/file
</pre>


Несколько заключительных мыслей: мы только поцарапали поверхность предмета пакетного анализа. Существует так много возможностей, на которые вы можете взглянуть, и мы даже не коснулись более глубокого вывода Hex и ASCII. Есть много ресурсов онлайн, чтобы помочь вам узнать больше о анализаторах пакетов, и я призываю вас найти их!

## Задание

Загрузите и установите инструмент Wireshark и поиграйте с интерфейсом.

## Вопрос

Каков флаг для захвата определенного интерфейса с tcpdump?

## Ответ

-i
