# System Calls / فراخوان‌های سیستمی

## محتویات درس

بریتنی را در درس قبل که یادتان هست؟ خب فرض کنید می‌خواهیم بریتنی را ببینیم و با هم کمی نوشیدنی بخوریم. حالا چطور از میان جمعیتِ بیرون به داخلی‌ترین حلقه‌ی او وارد شویم؟ می‌توانیم از فراخوان‌های سیستمی استفاده کنیم. فراخوان‌های سیستمی مانند اجازه‌های ورود VIPست که به شما درِ مخفی را برای دسترسی مستقیم به بریتنی نشان می‌دهد.

فراخوان‌های سیستم (سیس‌کال) به پروسه‌های فضای کاربری یک راه مخفی برای درخواست از کرنل برای انجام کار خاصی را ایجاد می‌کند. کرنل، سرویس‌های خاصی را از طریق API فراخوان‌های سیستمی در دسترس قرار می‌دهد. این سرویس‌ها به ما اجازه‌ی خواندن و نوشتن یک فایل، دستکاری حافظه‌ی مصرفی، دستکاری شبکه و غیره را می‌دهد. میزان سرویس‌ها از قبل تعیین شده است و نمی‌توانید به دلخواه، فراخوان‌های سیستمی را اضافه یا کم کنید. سیستم شما جدولی در خصوص فراخوان‌هایی که موجودند، دارد. هر فراخوان سیستم یک شناسه یا ID یکتا و مخصوص به خود دارد.

من در این دوره وارد جزئیات فراخوان‌های سیستمی نخواهم شد چرا که ورود به این مبحث نیاز به دانستن زبان C دارد.  در این حد بگویم که زمانی که یک برنامه مثل ls را فرا می‌خوانید، کدِ داخل برنامه شامل یک رَپِر / لفافه‌ی فراخوان سیستمی (system call wrapper) می‌شود (این همان فراخوان سیستمی نیست). سپس این لفافه / رپر، به فراخوان سیستمی متوسل می‌شود. فراخوان سیستمی یک تِرَپ / تله را اجرا می‌کند. سپس این تله توسط هندلرِ فراخوان سیستمی دریافت شده و سپس به فراخوان سیستمی موجود در جدول فراخوان‌های سیستمی ارجاع داده می‌شود. بگذارید با مثال مطلب را برای‌تان جا بیندازیم. فرض کنید ما می‌خواهیم فراخوان سیستمی stat()‎ را فراخوانی کنم. این فراخوان توسط یک شناسه‌ی syscall شناسایی می‌شود. هدف فراخوان سیستمیِ ‎stat()‎ جویا شدن وضعیت یک فایل است. خب یادتان هست که ما برنامه ls را در مدِ بدون دسترسی لازم اجرا کردیم؟ اینجاست که برنامه متوجه می‌شود که شما در حال تلاش برای ساخت یک سیس‌کال (فراخوان سیستمی) هستید، در نتیجه شما را یک لحظه به مد کرنل می‌برد که کارهای فراوانی در آنجا صورت می‌پذیرد. البته مهم‌ترینشان گشتن به دنبال شماره‌ی سیس‌کال، و پیدا کردن آن در جدولی که بر پایه‌ی شناسه‌ی سیس‌کال‌ها نوشته شده، است. در نهایت پروسه‌ی در حال اجرای شما یک وضعیت یا به اصطلاح گزارش را دریافت می‌کند که نتیجه موفقیت یا خطا را باز می‌گرداند. عمل‌کرد داخلی سیس‌کال‌ها واقعاً جزئیات بیشماری را در خود دارد و اگر می‌خواهید در این زمینه بیشتر یاد بگیرید، بهتر است که کمی به گشت و گذار در دنیای اینترنت بپردازید.

همچنین شما می‌توانید سیستم کال‌هایی که یک پروسه می‌سازد را با دستور strace مشاهده کنید. دستور strace برای دی‌باگ کردن اینکه یک برنامه چگونه اجرا می‌شود می‌تواند مورد استفاده مفید قرار بگیرد.

$ strace ls

## تمرین

تمرینی برای این درس نیست.

## سؤال آزمون

چه چیزی برای تغییر از مد کاربر به مد کرنل مورد استفاده قرار می‌گیرد؟

## پاسخ آزمون

system call
